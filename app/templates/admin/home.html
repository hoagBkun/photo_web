{% extends "admin/base.html" %} {% block title %}Quản lý Trang Chủ{% endblock %}
{% block content %}
<style>
    body {
        margin: 0;
        overflow-x: hidden;
    }
    .container-fluid {
        padding: 0;
    }
    .row {
        margin: 0;
    }
    .sidebar {
        display: none !important;
    }
    .content {
        margin-left: 0 !important;
        padding: 0 !important;
    }
    .navbar-admin {
        margin-left: 0 !important;
        padding: 10px 20px;
    }
    .preview-container {
        background-color: #ffffff;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        height: calc(100vh - 150px);
        overflow-y: auto;
    }
    .form-container {
        background-color: #f8f9fa;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        height: calc(100vh - 150px);
        overflow-y: auto;
    }
    .preview-header {
        background-color: #2c3e50;
        color: white;
        padding: 15px;
        text-align: center;
    }
    .preview-section {
        padding: 20px;
        border-bottom: 1px solid #eee;
    }
    .preview-footer {
        background-color: #2c3e50;
        color: white;
        padding: 20px;
        text-align: center;
    }
    .preview-img {
        max-width: 100%;
        height: auto;
        border-radius: 8px;
    }
    .modal-content {
        border-radius: 8px;
    }
    .modal-header {
        background-color: #2c3e50;
        color: white;
    }
</style>

<div class="container-fluid">
    <h2 class="my-4">Quản lý Trang Chủ</h2>
    <div class="row">
        <!-- Form Container -->
        <div class="col-md-6 form-container">
            <!-- Intro Section Form -->
            <h4>Phần Giới thiệu</h4>
            <form method="POST" enctype="multipart/form-data" id="introForm">
                <input type="hidden" name="form_name" value="intro" />
                {{ intro_form.hidden_tag() }}
                <div class="mb-3">
                    {{ intro_form.text.label(class="form-label") }} {{
                    intro_form.text(class="form-control", id="introText") }}
                </div>
                <div class="mb-3">
                    {{ intro_form.cta_text.label(class="form-label") }} {{
                    intro_form.cta_text(class="form-control", id="introCtaText")
                    }}
                </div>
                <div class="mb-3">
                    {{ intro_form.cta_url.label(class="form-label") }} {{
                    intro_form.cta_url(class="form-control", id="introCtaUrl")
                    }}
                </div>
                <div class="mb-3">
                    {{ intro_form.image.label(class="form-label") }} {{
                    intro_form.image(class="form-control", id="introImage") }}
                </div>
                <button type="submit" name="submit" class="btn btn-primary">
                    Cập nhật Giới thiệu
                </button>
            </form>

            <hr />
            <!-- Portfolio Form -->
            <h4>Portfolio</h4>
            <form
                method="POST"
                enctype="multipart/form-data"
                id="portfolioForm"
            >
                <input type="hidden" name="form_name" value="portfolio" />
                {{ portfolio_form.hidden_tag() }}
                <div class="mb-3">
                    {{ portfolio_form.title.label(class="form-label") }} {{
                    portfolio_form.title(class="form-control",
                    id="portfolioTitle") }}
                </div>
                <div class="mb-3">
                    {{ portfolio_form.image.label(class="form-label") }} {{
                    portfolio_form.image(class="form-control",
                    id="portfolioImage") }}
                </div>
                <button type="submit" name="submit" class="btn btn-primary">
                    Thêm Portfolio
                </button>
            </form>
            <table class="table table-bordered mt-3">
                <thead>
                    <tr>
                        <th>Tiêu đề</th>
                        <th>Hình ảnh</th>
                        <th>Hành động</th>
                    </tr>
                </thead>
                <tbody>
                    {% for portfolio in portfolios %}
                    <tr>
                        <td>{{ portfolio.title }}</td>
                        <td>
                            <img
                                src="{{ portfolio.image_url or '/static/images/default.jpg' }}"
                                alt="{{ portfolio.title }}"
                                width="50"
                            />
                        </td>
                        <td>
                            <button
                                class="btn btn-sm btn-warning"
                                onclick="loadPortfolioEdit({{ portfolio.id }})"
                            >
                                Sửa
                            </button>
                            <form
                                action="{{ url_for('admin.delete_home_item', model='portfolio', id=portfolio.id) }}"
                                method="POST"
                                style="display: inline"
                            >
                                <button
                                    type="submit"
                                    class="btn btn-sm btn-danger"
                                    onclick="return confirm('Bạn có chắc muốn xóa?')"
                                >
                                    Xóa
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <hr />
            <!-- Service Form -->
            <h4>Dịch vụ</h4>
            <form method="POST" enctype="multipart/form-data" id="serviceForm">
                <input type="hidden" name="form_name" value="service" />
                {{ service_form.hidden_tag() }}
                <div class="mb-3">
                    {{ service_form.title.label(class="form-label") }} {{
                    service_form.title(class="form-control", id="serviceTitle")
                    }}
                </div>
                <div class="mb-3">
                    {{ service_form.description.label(class="form-label") }} {{
                    service_form.description(class="form-control",
                    id="serviceDescription") }}
                </div>
                <div class="mb-3">
                    {{ service_form.cta_text.label(class="form-label") }} {{
                    service_form.cta_text(class="form-control",
                    id="serviceCtaText") }}
                </div>
                <div class="mb-3">
                    {{ service_form.cta_url.label(class="form-label") }} {{
                    service_form.cta_url(class="form-control",
                    id="serviceCtaUrl") }}
                </div>
                <div class="mb-3">
                    {{ service_form.image.label(class="form-label") }} {{
                    service_form.image(class="form-control", id="serviceImage")
                    }}
                </div>
                <button type="submit" name="submit" class="btn btn-primary">
                    Thêm Dịch vụ
                </button>
            </form>
            <table class="table table-bordered mt-3">
                <thead>
                    <tr>
                        <th>Tiêu đề</th>
                        <th>Mô tả</th>
                        <th>Hình ảnh</th>
                        <th>Hành động</th>
                    </tr>
                </thead>
                <tbody>
                    {% for service in services %}
                    <tr>
                        <td>{{ service.title }}</td>
                        <td>{{ service.description|truncate(100) }}</td>
                        <td>
                            <img
                                src="{{ service.image_url or '/static/images/default.jpg' }}"
                                alt="{{ service.title }}"
                                width="50"
                            />
                        </td>
                        <td>
                            <button
                                class="btn btn-sm btn-warning"
                                onclick="loadServiceEdit({{ service.id }})"
                            >
                                Sửa
                            </button>
                            <form
                                action="{{ url_for('admin.delete_home_item', model='service', id=service.id) }}"
                                method="POST"
                                style="display: inline"
                            >
                                <button
                                    type="submit"
                                    class="btn btn-sm btn-danger"
                                    onclick="return confirm('Bạn có chắc muốn xóa?')"
                                >
                                    Xóa
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <hr />
            <!-- Testimonial Form -->
            <h4>Đánh giá</h4>
            <form method="POST" id="testimonialForm">
                <input type="hidden" name="form_name" value="testimonial" />
                {{ testimonial_form.hidden_tag() }}
                <div class="mb-3">
                    {{ testimonial_form.content.label(class="form-label") }} {{
                    testimonial_form.content(class="form-control",
                    id="testimonialContent") }}
                </div>
                <div class="mb-3">
                    {{ testimonial_form.author.label(class="form-label") }} {{
                    testimonial_form.author(class="form-control",
                    id="testimonialAuthor") }}
                </div>
                <button type="submit" name="submit" class="btn btn-primary">
                    Thêm Đánh giá
                </button>
            </form>
            <table class="table table-bordered mt-3">
                <thead>
                    <tr>
                        <th>Nội dung</th>
                        <th>Tác giả</th>
                        <th>Hành động</th>
                    </tr>
                </thead>
                <tbody>
                    {% for testimonial in testimonials %}
                    <tr>
                        <td>{{ testimonial.content|truncate(100) }}</td>
                        <td>{{ testimonial.author }}</td>
                        <td>
                            <button
                                class="btn btn-sm btn-warning"
                                onclick="loadTestimonialEdit({{ testimonial.id }})"
                            >
                                Sửa
                            </button>
                            <form
                                action="{{ url_for('admin.delete_home_item', model='testimonial', id=testimonial.id) }}"
                                method="POST"
                                style="display: inline"
                            >
                                <button
                                    type="submit"
                                    class="btn btn-sm btn-danger"
                                    onclick="return confirm('Bạn có chắc muốn xóa?')"
                                >
                                    Xóa
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <hr />
            <!-- Featured Post Form -->
            <h4>Bài viết nổi bật</h4>
            <form method="POST" id="featuredPostForm">
                <input type="hidden" name="form_name" value="featured_post" />
                {{ featured_post_form.hidden_tag() }}
                <div class="mb-3">
                    {{ featured_post_form.post_id.label(class="form-label") }}
                    {{ featured_post_form.post_id(class="form-control",
                    id="featuredPostId",
                    onchange="previewFeaturedPost(this.value)") }}
                </div>
                <button type="submit" name="submit" class="btn btn-primary">
                    Thêm Bài viết nổi bật
                </button>
            </form>
            <table class="table table-bordered mt-3">
                <thead>
                    <tr>
                        <th>Tiêu đề</th>
                        <th>Hình ảnh</th>
                        <th>Hành động</th>
                    </tr>
                </thead>
                <tbody>
                    {% for post in featured_posts %}
                    <tr>
                        <td>{{ post.title }}</td>
                        <td>
                            <img
                                src="{{ post.image_url or '/static/images/default.jpg' }}"
                                alt="{{ post.title }}"
                                width="50"
                            />
                        </td>
                        <td>
                            <form
                                action="{{ url_for('admin.delete_home_item', model='featured_post', id=post.id) }}"
                                method="POST"
                                style="display: inline"
                            >
                                <button
                                    type="submit"
                                    class="btn btn-sm btn-danger"
                                    onclick="return confirm('Bạn có chắc muốn xóa?')"
                                >
                                    Xóa
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Preview Container -->
        <div class="col-md-6 preview-container">
            <!-- Header -->
            <header class="preview-header">
                <h1>HoagART</h1>
                <nav>
                    <a href="#" class="text-white mx-2">Trang chủ</a>
                    <a href="#" class="text-white mx-2">Dịch vụ</a>
                    <a href="#" class="text-white mx-2">Portfolio</a>
                    <a href="#" class="text-white mx-2">Liên hệ</a>
                </nav>
            </header>

            <!-- Intro Section -->
            <section class="preview-section" id="previewIntro">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <h2 id="previewIntroText">
                            {{ intro.text if intro else 'Chào mừng đến với
                            HoagART' }}
                        </h2>
                        <p>
                            Chúng tôi cung cấp dịch vụ nhiếp ảnh chuyên nghiệp。
                        </p>
                        <a
                            id="previewIntroCta"
                            href="{{ intro.cta_url if intro else '#' }}"
                            class="btn btn-primary"
                            >{{ intro.cta_text if intro else 'Browse More' }}</a
                        >
                    </div>
                    <div class="col-md-6">
                        <img
                            id="previewIntroImage"
                            src="{{ intro.image_url if intro else '/static/images/default.jpg' }}"
                            alt="Intro Image"
                            class="preview-img"
                        />
                    </div>
                </div>
            </section>

            <!-- Portfolio Section -->
            <section class="preview-section" id="previewPortfolio">
                <h2>Portfolio</h2>
                <div class="row">
                    {% for portfolio in portfolios %}
                    <div class="col-md-4 mb-4">
                        <div class="card">
                            <img
                                src="{{ portfolio.image_url or '/static/images/default.jpg' }}"
                                alt="{{ portfolio.title }}"
                                class="card-img-top preview-img"
                            />
                            <div class="card-body">
                                <h5 class="card-title">
                                    {{ portfolio.title }}
                                </h5>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </section>

            <!-- Services Section -->
            <section class="preview-section" id="previewServices">
                <h2>Services</h2>
                <div class="row">
                    {% for service in services %}
                    <div class="col-md-4 mb-4">
                        <div class="card">
                            <img
                                src="{{ service.image_url or '/static/images/default.jpg' }}"
                                alt="{{ service.title }}"
                                class="card-img-top preview-img"
                            />
                            <div class="card-body">
                                <h5 class="card-title">{{ service.title }}</h5>
                                <p class="card-text">
                                    {{ service.description }}
                                </p>
                                <a
                                    href="{{ service.cta_url }}"
                                    class="btn btn-primary"
                                    >{{ service.cta_text }}</a
                                >
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </section>

            <!-- Testimonials Section -->
            <section class="preview-section" id="previewTestimonials">
                <h2>Testimonials</h2>
                <div class="row">
                    {% for testimonial in testimonials %}
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-body">
                                <p class="card-text">
                                    "{{ testimonial.content }}"
                                </p>
                                <h6 class="card-title">
                                    {{ testimonial.author }}
                                </h6>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </section>

            <!-- Featured Posts Section -->
            <section class="preview-section" id="previewFeaturedPosts">
                <h2>Featured Posts</h2>
                <div class="row">
                    {% for post in featured_posts %}
                    <div class="col-md-4 mb-4">
                        <div class="card">
                            <img
                                src="{{ post.image_url or '/static/images/default.jpg' }}"
                                alt="{{ post.title }}"
                                class="card-img-top preview-img"
                            />
                            <div class="card-body">
                                <h5 class="card-title">{{ post.title }}</h5>
                                <p class="card-text">
                                    {{ post.content|truncate(100)|safe }}
                                </p>
                                <a
                                    href="{{ url_for('blog.blog_detail', id=post.id) }}"
                                    class="btn btn-primary"
                                    >Read More</a
                                >
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                    <div
                        id="newFeaturedPostPreview"
                        class="col-md-4 mb-4"
                        style="display: none"
                    >
                        <div class="card">
                            <img
                                id="previewFeaturedPostImage"
                                src="/static/images/default.jpg"
                                alt="New Post"
                                class="card-img-top preview-img"
                            />
                            <div class="card-body">
                                <h5
                                    id="previewFeaturedPostTitle"
                                    class="card-title"
                                ></h5>
                                <p
                                    id="previewFeaturedPostContent"
                                    class="card-text"
                                ></p>
                                <a
                                    id="previewFeaturedPostCta"
                                    href="#"
                                    class="btn btn-primary"
                                    >Read More</a
                                >
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Footer -->
            <footer class="preview-footer">
                <p>© 2025 HoagART. All rights reserved.</p>
            </footer>
        </div>
    </div>

    <!-- Modal for Editing Portfolio -->
    <div class="modal fade" id="editPortfolioModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Portfolio</h5>
                    <button
                        type="button"
                        class="btn-close"
                        data-bs-dismiss="modal"
                        aria-label="Close"
                    ></button>
                </div>
                <div class="modal-body">
                    <form
                        id="editPortfolioForm"
                        method="POST"
                        enctype="multipart/form-data"
                        action="{{ url_for('admin.edit_home_item', model='portfolio', id=0) }}"
                    >
                        <input
                            type="hidden"
                            name="portfolio_id"
                            id="editPortfolioId"
                        />
                        <div class="mb-3">
                            <label for="editPortfolioTitle" class="form-label"
                                >Title</label
                            >
                            <input
                                type="text"
                                class="form-control"
                                id="editPortfolioTitle"
                                name="title"
                                required
                            />
                        </div>
                        <div class="mb-3">
                            <label for="editPortfolioImage" class="form-label"
                                >Image</label
                            >
                            <input
                                type="file"
                                class="form-control"
                                id="editPortfolioImage"
                                name="image"
                                accept="image/*"
                            />
                        </div>
                        <button
                            type="submit"
                            name="submit"
                            class="btn btn-primary"
                        >
                            Save Changes
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Editing Service -->
    <div class="modal fade" id="editServiceModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Service</h5>
                    <button
                        type="button"
                        class="btn-close"
                        data-bs-dismiss="modal"
                        aria-label="Close"
                    ></button>
                </div>
                <div class="modal-body">
                    <form
                        id="editServiceForm"
                        method="POST"
                        enctype="multipart/form-data"
                        action="{{ url_for('admin.edit_home_item', model='service', id=0) }}"
                    >
                        <input
                            type="hidden"
                            name="service_id"
                            id="editServiceId"
                        />
                        <div class="mb-3">
                            <label for="editServiceTitle" class="form-label"
                                >Title</label
                            >
                            <input
                                type="text"
                                class="form-control"
                                id="editServiceTitle"
                                name="title"
                                required
                            />
                        </div>
                        <div class="mb-3">
                            <label
                                for="editServiceDescription"
                                class="form-label"
                                >Description</label
                            >
                            <textarea
                                class="form-control"
                                id="editServiceDescription"
                                name="description"
                                required
                            ></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="editServiceCtaText" class="form-label"
                                >CTA Button</label
                            >
                            <input
                                type="text"
                                class="form-control"
                                id="editServiceCtaText"
                                name="cta_text"
                                required
                            />
                        </div>
                        <div class="mb-3">
                            <label for="editServiceCtaUrl" class="form-label"
                                >CTA Link</label
                            >
                            <input
                                type="text"
                                class="form-control"
                                id="editServiceCtaUrl"
                                name="cta_url"
                                required
                            />
                        </div>
                        <div class="mb-3">
                            <label for="editServiceImage" class="form-label"
                                >Image</label
                            >
                            <input
                                type="file"
                                class="form-control"
                                id="editServiceImage"
                                name="image"
                                accept="image/*"
                            />
                        </div>
                        <button
                            type="submit"
                            name="submit"
                            class="btn btn-primary"
                        >
                            Save Changes
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Editing Testimonial -->
    <div class="modal fade" id="editTestimonialModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Testimonial</h5>
                    <button
                        type="button"
                        class="btn-close"
                        data-bs-dismiss="modal"
                        aria-label="Close"
                    ></button>
                </div>
                <div class="modal-body">
                    <form
                        id="editTestimonialForm"
                        method="POST"
                        action="{{ url_for('admin.edit_home_item', model='testimonial', id=0) }}"
                    >
                        <input
                            type="hidden"
                            name="testimonial_id"
                            id="editTestimonialId"
                        />
                        <div class="mb-3">
                            <label
                                for="editTestimonialContent"
                                class="form-label"
                                >Content</label
                            >
                            <textarea
                                class="form-control"
                                id="editTestimonialContent"
                                name="content"
                                required
                            ></textarea>
                        </div>
                        <div class="mb-3">
                            <label
                                for="editTestimonialAuthor"
                                class="form-label"
                                >Author</label
                            >
                            <input
                                type="text"
                                class="form-control"
                                id="editTestimonialAuthor"
                                name="author"
                                required
                            />
                        </div>
                        <button
                            type="submit"
                            name="submit"
                            class="btn btn-primary"
                        >
                            Save Changes
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        // JavaScript for initialization and modal handling
        document.addEventListener("DOMContentLoaded", function () {
            // Intro Section Preview
            const introText = document.getElementById("introText");
            const introCtaText = document.getElementById("introCtaText");
            const introCtaUrl = document.getElementById("introCtaUrl");
            const introImage = document.getElementById("introImage");
            const previewIntroText =
                document.getElementById("previewIntroText");
            const previewIntroCta = document.getElementById("previewIntroCta");
            const previewIntroImage =
                document.getElementById("previewIntroImage");

            if (introText) {
                introText.addEventListener("input", () => {
                    previewIntroText.textContent =
                        introText.value || "Chào mừng đến với HoagART";
                });
            }
            if (introCtaText) {
                introCtaText.addEventListener("input", () => {
                    previewIntroCta.textContent =
                        introCtaText.value || "Browse More";
                });
            }
            if (introCtaUrl) {
                introCtaUrl.addEventListener("input", () => {
                    previewIntroCta.href = introCtaUrl.value || "#";
                });
            }
            if (introImage) {
                introImage.addEventListener("change", (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            previewIntroImage.src = e.target.result;
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }

            // Portfolio Preview
            const portfolioTitle = document.getElementById("portfolioTitle");
            const portfolioImage = document.getElementById("portfolioImage");
            if (portfolioImage) {
                portfolioImage.addEventListener("change", (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            const newPortfolio = document.createElement("div");
                            newPortfolio.className = "col-md-4 mb-4";
                            newPortfolio.innerHTML = `
                            <div class="card">
                                <img src="${e.target.result}" alt="${
                                portfolioTitle.value || "New Portfolio"
                            }" class="card-img-top preview-img">
                                <div class="card-body">
                                    <h5 class="card-title">${
                                        portfolioTitle.value || "New Portfolio"
                                    }</h5>
                                </div>
                            </div>
                        `;
                            document
                                .getElementById("previewPortfolio")
                                .querySelector(".row")
                                .appendChild(newPortfolio);
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }

            // Service Preview
            const serviceTitle = document.getElementById("serviceTitle");
            const serviceDescription =
                document.getElementById("serviceDescription");
            const serviceCtaText = document.getElementById("serviceCtaText");
            const serviceCtaUrl = document.getElementById("serviceCtaUrl");
            const serviceImage = document.getElementById("serviceImage");
            if (serviceImage) {
                serviceImage.addEventListener("change", (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            const newService = document.createElement("div");
                            newService.className = "col-md-4 mb-4";
                            newService.innerHTML = `
                            <div class="card">
                                <img src="${e.target.result}" alt="${
                                serviceTitle.value || "New Service"
                            }" class="card-img-top preview-img">
                                <div class="card-body">
                                    <h5 class="card-title">${
                                        serviceTitle.value || "New Service"
                                    }</h5>
                                    <p class="card-text">${
                                        serviceDescription.value || ""
                                    }</p>
                                    <a href="${
                                        serviceCtaUrl.value || "#"
                                    }" class="btn btn-primary">${
                                serviceCtaText.value || "Learn More"
                            }</a>
                                </div>
                            </div>
                        `;
                            document
                                .getElementById("previewServices")
                                .querySelector(".row")
                                .appendChild(newService);
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }

            // Testimonial Preview
            const testimonialContent =
                document.getElementById("testimonialContent");
            const testimonialAuthor =
                document.getElementById("testimonialAuthor");
            if (testimonialContent && testimonialAuthor) {
                const updateTestimonialPreview = () => {
                    const newTestimonial = document.createElement("div");
                    newTestimonial.className = "col-md-6 mb-4";
                    newTestimonial.innerHTML = `
                    <div class="card">
                        <div class="card-body">
                            <p class="card-text">"${
                                testimonialContent.value || "New Testimonial"
                            }"</p>
                            <h6 class="card-title">${
                                testimonialAuthor.value || "Anonymous"
                            }</h6>
                        </div>
                    </div>
                `;
                    const previewTestimonials = document
                        .getElementById("previewTestimonials")
                        .querySelector(".row");
                    const existingPreview =
                        previewTestimonials.querySelector(".preview-temp");
                    if (existingPreview) {
                        previewTestimonials.removeChild(existingPreview);
                    }
                    if (testimonialContent.value || testimonialAuthor.value) {
                        newTestimonial.classList.add("preview-temp");
                        previewTestimonials.appendChild(newTestimonial);
                    }
                };
                testimonialContent.addEventListener(
                    "input",
                    updateTestimonialPreview
                );
                testimonialAuthor.addEventListener(
                    "input",
                    updateTestimonialPreview
                );
            }
        });

        // Load Portfolio Edit Data
        function loadPortfolioEdit(id) {
            fetch(`/admin/home/portfolio/edit/${id}`)
                .then((response) => response.json())
                .then((data) => {
                    document.getElementById("editPortfolioId").value = data.id;
                    document.getElementById("editPortfolioTitle").value =
                        data.title;
                    document.getElementById(
                        "editPortfolioForm"
                    ).action = `/admin/home/portfolio/edit/${data.id}`;
                    new bootstrap.Modal(
                        document.getElementById("editPortfolioModal")
                    ).show();
                });
        }

        // Load Service Edit Data
        function loadServiceEdit(id) {
            fetch(`/admin/home/service/edit/${id}`)
                .then((response) => response.json())
                .then((data) => {
                    document.getElementById("editServiceId").value = data.id;
                    document.getElementById("editServiceTitle").value =
                        data.title;
                    document.getElementById("editServiceDescription").value =
                        data.description;
                    document.getElementById("editServiceCtaText").value =
                        data.cta_text;
                    document.getElementById("editServiceCtaUrl").value =
                        data.cta_url;
                    document.getElementById(
                        "editServiceForm"
                    ).action = `/admin/home/service/edit/${data.id}`;
                    new bootstrap.Modal(
                        document.getElementById("editServiceModal")
                    ).show();
                });
        }

        // Load Testimonial Edit Data
        function loadTestimonialEdit(id) {
            fetch(`/admin/home/testimonial/edit/${id}`)
                .then((response) => response.json())
                .then((data) => {
                    document.getElementById("editTestimonialId").value =
                        data.id;
                    document.getElementById("editTestimonialContent").value =
                        data.content;
                    document.getElementById("editTestimonialAuthor").value =
                        data.author;
                    document.getElementById(
                        "editTestimonialForm"
                    ).action = `/admin/home/testimonial/edit/${data.id}`;
                    new bootstrap.Modal(
                        document.getElementById("editTestimonialModal")
                    ).show();
                });
        }

        // Preview Featured Post
        function previewFeaturedPost(postId) {
            if (!postId) {
                document.getElementById(
                    "newFeaturedPostPreview"
                ).style.display = "none";
                return;
            }
            fetch(`/blog/${postId}`, {
                headers: {
                    Accept: "application/json",
                },
            })
                .then((response) => response.json())
                .then((data) => {
                    document.getElementById(
                        "previewFeaturedPostTitle"
                    ).textContent = data.title;
                    document.getElementById(
                        "previewFeaturedPostContent"
                    ).innerHTML = data.content.substring(0, 100) + "...";
                    document.getElementById("previewFeaturedPostImage").src =
                        data.image_url;
                    document.getElementById(
                        "previewFeaturedPostCta"
                    ).href = `/blog/${data.id}`;
                    document.getElementById(
                        "newFeaturedPostPreview"
                    ).style.display = "block";
                })
                .catch((error) => {
                    console.error("Error fetching post:", error);
                    document.getElementById(
                        "newFeaturedPostPreview"
                    ).style.display = "none";
                });
        }
    </script>
    {% endblock %}
</div>
